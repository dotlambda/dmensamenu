#! /usr/bin/env nix-shell
#! nix-shell -i python3 -p python3Packages.requests python3Packages.beautifulsoup4

import requests
from bs4 import BeautifulSoup
from subprocess import Popen, PIPE

meals = []

page = requests.get('http://rolf-schneider.net/mensa/').text
html = BeautifulSoup(page, 'html.parser')
for tr in html.body.table.find_all('tr'):
    if (tr.find('td')):
        text = ''
        text += tr.find('td', id='output').text
        text += ' ' * (5 - len(text))
        text += tr.find('td', id='euro').text + 'â‚¬'
        text += ' ' * (12 - len(text))
        text += tr.find('td', id='meal').text
        meals.append(text)

p = Popen(['dmenu', '-l', str(len(meals))], stdin=PIPE)
p.communicate(input=str.encode('\n'.join(meals)))
